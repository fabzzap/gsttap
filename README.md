GSTTAP
======

gsttap adds support for Commodore tapes to the GStreamer framework.

With it, it is possible to play common Commodore tape files (TAP, DMP) and to
create TAP or DMP files from an audio stream generated by GStreamer.

Building it
-----------
You must have the GStreamer 1.x development files installed. For some of the plugins (namely, those that can read and write audio streams), the development files for tapencoder and tapdecoder (https://github.com/fabzzap/libtap) must be present.
To bootstrap, type

    ./autogen.sh

This will create some basic files and the configure script.

Then type

    ./configure

to create the Makefiles. If you have the development files for tapencoder and tapdecoder, and they are not installed in the standard places (.h files in /usr/include, .so files in /usr/lib), append `--with-libtap-includes=<directory containing the .h files> --with-libtap-libs=<directory containing the .so files>`

Then type

    make

to actually compile and link the plugins.

The following plug-ins will be built, containing the following GStreamer elements:
* libgsttap.so
  * tapfileenc - encode raw TAP format into the common TAP container file
  * tapfiledec - decode the common TAP container file into raw TAP format
  * dmpdec - decode the DC2N DMP container file into raw TAP format
  * tapconvert - adapts rate of raw TAP format, and allows to convert between half waves and full waves
* libgsttapenc.so (only if tapencoder is present)
  * tapenc - encode an audio stream into raw TAP format
* libgsttapdec.so (only if tapdecoder is present)
  * tapdec - decode raw TAP format into an audio stream

libgsttapenc.so requires tapencoder (libtapencoder.so or tapencoder.dll) to be present among the runtime libraries, and libgsttapdec.so requires tapdecoder (libtapdecoder.so or tapdecoder.dll) to be present among the runtime libraries. On a Unix-like system, typically, this means that these libraries must be in the directory /usr/lib, or that the environment variable LD_LIBRARY_PATH must contain the directory where they are in. On Windows it is enough to have these libraries in the same folder as the GStreamer plug-in.

All those plug-ins operate on the raw TAP format. A stream in raw TAP format is a stream of samples represented as 32-bit little-endian unsigned numbers: each one is the length of a full wave or a half wave, in time units.
audio/x-tap - format
rate (G_TYPE_INT) - number of time units per second
halfwaves (G_TYPE_BOOLEAN) - if true, a sample is a half wave, otherwise a full wave

Example: a stream of type audio/x-tap has halfwaves=false, and its byte stream is
    0a 00 00 00 08 00 00 00 10 00 00 00

This is a representation of the signal, coming from a Commodore computer and directed towards a datasette (so, each wave is high for the first half and low for the second half)

    +----+    +---+   +-------+
         |    |   |   |       |
         +----+   +---+       +------+
    |10 units |8 units|15 units      |

Examples of pipelines
=====================

    gst-launch-1.0 filesrc location=BONGO.TAP ! tapfiledec ! tapdec ! pulsesink

Opens file BONGO.TAP, decodes into audio/x-tap, then decodes that into raw audio and plays that

    gst-launch-1.0 filesrc location=BONGO.TAP ! decodebin ! pulsesink

Same as above: since files with extensions TAP or DMP will be auto-detected, this will also work, decodebin will build the pipeline automatically

    gst-launch-1.0 filesrc location=BONGO.TAP ! tapfiledec ! tapdec ! wavenc ! filesink location=ueive.wav

The raw audio from tapdec is encoded into WAV and written to the file ueive.wav. By default the waves will be delimited by falling edges, the waveform will be square and the frequency of the WAV will be 1/8 of the CPU frequency of the computer the TAP file was for (e.g. if the TAP was for will be delimited byC64, it will be 123156 Hz).

    gst-launch-1.0 filesrc location=BONGO.TAP ! tapfiledec ! tapdec inverted=false waveform=sine ! wavenc ! filesink location=ueive.wav

Same as above, but waves will be delimited by rising edges and the waveform will be sinusoidal.

    gst-launch-1.0 filesrc location=BONGO.TAP ! tapfiledec ! tapconvert ! audio/x-tap,rate=44100 ! tapdec inverted=false waveform=sine ! wavenc ! filesink location=ueive.wav

Force conversion to a given sample rate before converting the TAP into a WAV. tapconvert takes the raw TAP produced by opening the file and changes its rate to the one of the downstream element.

    gst-launch-1.0 filesrc location=tape.wav ! wavparse ! audioconvert ! tapenc ! tapconvert ! tapfileenc ! filesink location=grozo.tap

Open tape.wav (filesrc), read raw audio from WAV (wavparse), convert its format to the only format tapenc supports, that is 32-bit mono (audioconvert), encode audio into raw TAP (tapenc), convert rate of raw TAP (tapconvert), encode into TAP file format (tapfileenc), write it to file (filesink)

    gst-launch-1.0 filesrc location=ueive.mp3 ! mpegaudioparse ! mpg123audiodec ! audioconvert ! tapenc inverted=true ! tapconvert ! tapfileenc ! filesink location=grozo.tap

Using MP3 files is not advised because it is a lossy format, but this pipeline, simplar to the previous one but with an MP3 file instead of a WAV one, works anyway. The parameter inverted=true passed to tapenc means to detect falling edges as pulse delimiter

    gst-launch-1.0 filesrc location=DUMP0128.DMP ! dmpdec ! tapconvert ! tapfileenc ! filesink location=grozo.tap

Convert a DMP file, as created by a DC2N device, to TAP
